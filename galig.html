<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Galaga Clone â€“ Complete</title>
<style>
  body {
    background: black;
    margin: 0;
    display: flex;
    justify-content: center;
  }
  canvas {
    image-rendering: pixelated;
  }
</style>
</head>
<body>
<canvas id="c" width="224" height="288"></canvas>
<script>
/* ---------------- Audio Engine ---------------- */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function beep(freq, duration, type="square", gain=0.1){
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = type; o.frequency.value = freq; g.gain.value = gain;
  o.connect(g); g.connect(audioCtx.destination);
  o.start();
  g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
  o.stop(audioCtx.currentTime + duration);
}
const SFX = {
  shoot() { beep(1200,0.08,"square",0.08); },
  enemyShoot() { beep(600,0.1,"square",0.06); },
  explode() {
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = "square"; o.frequency.value = 200;
    g.gain.value = 0.15;
    o.connect(g); g.connect(audioCtx.destination);
    o.start(); g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+0.2);
    o.stop(audioCtx.currentTime+0.2);
  },
  dive() { beep(800,0.4,"square",0.08); },
  wave() { beep(440,0.15); setTimeout(()=>beep(660,0.15),150); setTimeout(()=>beep(880,0.2),300); }
};

/* ---------------- Canvas & Scale ---------------- */
const c=document.getElementById("c");
const ctx=c.getContext("2d"); ctx.imageSmoothingEnabled=false;
const SCALE = 3;
c.style.width = c.width*SCALE+"px";
c.style.height = c.height*SCALE+"px";

/* ---------------- Colors ---------------- */
const COLORS = { bg:"#000", ship:"#00ffff", bee:"#ff0000", bullet:"#ffff00", text:"#fff" };

/* ---------------- Game State ---------------- */
let score=0, level=1, lives=3, frame=0;
const player={x:112,y:250,alive:true};
let bullets=[], enemyBullets=[], enemies=[];
let keys={};

/* ---------------- Input ---------------- */
addEventListener("keydown", e=>keys[e.code]=true);
addEventListener("keyup", e=>keys[e.code]=false);

/* ---------------- Drawing ---------------- */
function drawShip(x,y){
  ctx.fillStyle=COLORS.ship;
  ctx.fillRect(x-4,y,8,2);
  ctx.fillRect(x-2,y-2,4,2);
  ctx.fillRect(x-1,y-4,2,2);
}
function drawBee(x,y){
  ctx.fillStyle=COLORS.bee;
  ctx.fillRect(x-4,y-2,8,4);
  ctx.fillRect(x-2,y-4,4,2);
  ctx.fillRect(x-2,y+2,4,2);
}

/* ---------------- Spawn Wave ---------------- */
function spawnWave(){
  enemies=[]; bullets=[]; enemyBullets=[];
  for(let r=0;r<4;r++){
    for(let c=0;c<8;c++){
      enemies.push({
        bx:32+c*20, by:48+r*16, x:0, y:0,
        alive:true, dive:false, phase:Math.random()*Math.PI*2
      });
    }
  }
  SFX.wave();
}

/* ---------------- Life Loss ---------------- */
function loseLife(){
  lives--; bullets=[]; enemyBullets=[]; player.x=112;
  if(lives<=0){ lives=3; score=0; level=1; spawnWave(); }
}

/* ---------------- Game Loop ---------------- */
function update(){
  frame++;

  // Player movement
  if(keys.ArrowLeft) player.x-=2;
  if(keys.ArrowRight) player.x+=2;
  player.x=Math.max(8,Math.min(216,player.x));

  // Shooting
  if(keys.Space && frame%10===0){ bullets.push({x:player.x,y:player.y}); SFX.shoot(); }

  bullets.forEach(b=>b.y-=4);
  enemyBullets.forEach(b=>b.y+=2+level*0.4);
  bullets=bullets.filter(b=>b.y>0);
  enemyBullets=enemyBullets.filter(b=>b.y<288);

  // Enemy movement
  enemies.forEach(e=>{
    if(!e.alive) return;
    if(!e.dive){
      e.x=e.bx+Math.sin(frame*0.02+e.phase)*6;
      e.y=e.by;
      if(Math.random()<0.0008+level*0.0003){ e.dive=true; SFX.dive(); }
    } else {
      e.y+=1.5+level*0.3;
      e.x+=Math.sin(frame*0.15)*2;
      if(frame % (40-Math.min(level*2,30))===0){ enemyBullets.push({x:e.x,y:e.y}); SFX.enemyShoot(); }
      if(e.y>300) e.dive=false;
    }
  });

  // Bullet collisions
  bullets.forEach(b=>{
    enemies.forEach(e=>{
      if(e.alive && Math.abs(b.x-e.x)<6 && Math.abs(b.y-e.y)<6){
        e.alive=false; b.y=-100; score+=e.dive?100:50; SFX.explode();
      }
    });
  });

  // Enemy bullets hitting player
  enemyBullets.forEach(b=>{
    if(Math.abs(b.x-player.x)<6 && Math.abs(b.y-player.y)<6){ loseLife(); }
  });

  // Level complete
  if(enemies.every(e=>!e.alive)){ level++; spawnWave(); }
}

function draw(){
  ctx.fillStyle=COLORS.bg; ctx.fillRect(0,0,224,288);
  drawShip(player.x,player.y);

  ctx.fillStyle=COLORS.bullet;
  bullets.forEach(b=>ctx.fillRect(b.x-1,b.y,2,4));
  ctx.fillStyle=COLORS.bee;
  enemyBullets.forEach(b=>ctx.fillRect(b.x-1,b.y,2,4));
  enemies.forEach(e=>{ if(e.alive) drawBee(e.x,e.y); });

  ctx.fillStyle=COLORS.text;
  ctx.fillText(`SCORE ${score}`,8,10);
  ctx.fillText(`LEVEL ${level}`,160,10);
  ctx.fillText(`LIVES ${lives}`,8,280);
}

function loop(){ update(); draw(); requestAnimationFrame(loop); }
loop();
</script>
</body>
</html>
