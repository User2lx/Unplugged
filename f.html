<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>2D Action Side Scroller</title>
<style>
  body { margin: 0; background: #111; overflow: hidden; }
  canvas { display: block; margin: auto; background: #87ceeb; }
</style>
</head>
<body>
<canvas id="game" width="800" height="450"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const gravity = 0.6;
let cameraX = 0;

// INPUT
const keys = {};
addEventListener("keydown", e => keys[e.key] = true);
addEventListener("keyup", e => keys[e.key] = false);

// PLAYER
const player = {
  x: 100, y: 0, w: 40, h: 50,
  dx: 0, dy: 0,
  speed: 4, jump: 12,
  grounded: false,
  facing: 1,
  health: 5,
  attacking: false,
  attackTimer: 0
};

// PLATFORMS
const platforms = [
  { x: 0, y: 400, w: 2000, h: 50 },
  { x: 300, y: 320, w: 120, h: 20 },
  { x: 550, y: 260, w: 120, h: 20 },
  { x: 850, y: 300, w: 150, h: 20 }
];

// ENEMIES
let enemies = [
  { x: 500, y: 360, w: 40, h: 40, dx: 1.2, alive: true },
  { x: 750, y: 360, w: 40, h: 40, dx: -1, alive: true }
];

// COLLISION
function hit(a, b) {
  return (
    a.x < b.x + b.w &&
    a.x + a.w > b.x &&
    a.y < b.y + b.h &&
    a.y + a.h > b.y
  );
}

function update() {
  // INPUT
  player.dx = 0;
  if (keys["a"]) { player.dx = -player.speed; player.facing = -1; }
  if (keys["d"]) { player.dx = player.speed; player.facing = 1; }

  if ((keys["w"] || keys[" "]) && player.grounded) {
    player.dy = -player.jump;
    player.grounded = false;
  }

  // ATTACK
  if (keys["j"] && !player.attacking) {
    player.attacking = true;
    player.attackTimer = 10;
  }

  // PHYSICS
  player.dy += gravity;
  player.x += player.dx;
  player.y += player.dy;

  // PLATFORM COLLISION
  player.grounded = false;
  platforms.forEach(p => {
    if (hit(player, p) && player.dy > 0) {
      player.y = p.y - player.h;
      player.dy = 0;
      player.grounded = true;
    }
  });

  // ATTACK TIMER
  if (player.attacking) {
    player.attackTimer--;
    if (player.attackTimer <= 0) player.attacking = false;
  }

  // ENEMIES
  enemies.forEach(e => {
    if (!e.alive) return;

    e.x += e.dx;
    if (e.x < 450 || e.x > 900) e.dx *= -1;

    // PLAYER DAMAGE
    if (hit(player, e)) {
      player.health--;
      player.x -= 30 * e.dx;
      if (player.health <= 0) reset();
    }

    // ATTACK HIT
    if (player.attacking) {
      const atk = {
        x: player.x + (player.facing === 1 ? player.w : -30),
        y: player.y + 10,
        w: 30,
        h: 30
      };
      if (hit(atk, e)) e.alive = false;
    }
  });

  // FALL RESET
  if (player.y > canvas.height + 200) reset();

  // CAMERA
  cameraX = Math.max(0, player.x - canvas.width / 3);
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.save();
  ctx.translate(-cameraX, 0);

  // PLATFORMS
  ctx.fillStyle = "#2f3542";
  platforms.forEach(p => ctx.fillRect(p.x, p.y, p.w, p.h));

  // PLAYER
  ctx.fillStyle = "#ff4757";
  ctx.fillRect(player.x, player.y, player.w, player.h);

  // ATTACK BOX
  if (player.attacking) {
    ctx.fillStyle = "#ffa502";
    ctx.fillRect(
      player.x + (player.facing === 1 ? player.w : -30),
      player.y + 10,
      30, 30
    );
  }

  // ENEMIES
  ctx.fillStyle = "#2ed573";
  enemies.forEach(e => {
    if (e.alive) ctx.fillRect(e.x, e.y, e.w, e.h);
  });

  ctx.restore();

  // UI
  ctx.fillStyle = "#fff";
  ctx.font = "16px monospace";
  ctx.fillText("Health: " + player.health, 20, 30);
}

function reset() {
  player.x = 100;
  player.y = 0;
  player.health = 5;
  enemies.forEach(e => e.alive = true);
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
