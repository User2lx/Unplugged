<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Bird - Alive Flat with High Score</title>
<style>
  body {
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: #4ec0ca;
    overflow: hidden;
    font-family: sans-serif;
  }
  canvas {
    border: 2px solid #333;
    display: block;
  }
</style>
</head>
<body>
<canvas id="gameCanvas" width="400" height="600"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Game state
let frame = 0;
let score = 0;
let highScore = localStorage.getItem('flappyHighScore') || 0;
let gameOver = false;
let inMenu = true;

// Bird
let bird = {
  x: 80,
  y: 300,
  width: 30,
  height: 30,
  gravity: 0.6,
  velocity: 0,
  jump: -10,
  color: '#FFD93D',
  rotation: 0,
  wingOffset: 0,
  wingDirection: 1,
  bounce: 0,
  bounceDir: 1
};

// Pipes
let pipes = [];
const pipeWidth = 60;
const pipeGap = 150;

// Clouds
let clouds = [
  { x: 50, y: 80, width: 60, height: 30, speed: 0.3, alpha: 1, fadeDir: -0.005 },
  { x: 200, y: 120, width: 80, height: 40, speed: 0.2, alpha: 1, fadeDir: 0.003 },
  { x: 350, y: 60, width: 50, height: 25, speed: 0.25, alpha: 1, fadeDir: -0.004 }
];

// Ground
const groundHeight = 80;
let groundX = 0;
const groundSpeed = 3;

// Controls
document.addEventListener('keydown', e => { if(e.code === 'Space') handleClick(); });
canvas.addEventListener('click', handleClick);

function handleClick(){
  if(inMenu){
    inMenu = false;
    restart();
  } else if(!gameOver){
    bird.velocity = bird.jump;
  } else {
    inMenu = true;
  }
}

// Rounded rectangle helper
function roundRect(x, y, width, height, radius, color) {
  ctx.fillStyle = color;
  ctx.beginPath();
  ctx.moveTo(x + radius, y);
  ctx.lineTo(x + width - radius, y);
  ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
  ctx.lineTo(x + width, y + height - radius);
  ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
  ctx.lineTo(x + radius, y + height);
  ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
  ctx.lineTo(x, y + radius);
  ctx.quadraticCurveTo(x, y, x + radius, y);
  ctx.closePath();
  ctx.fill();
}

// Collision detection
function checkCollision(pipe) {
  if (
    bird.x < pipe.x + pipeWidth &&
    bird.x + bird.width > pipe.x &&
    (bird.y < pipe.top || bird.y + bird.height > pipe.bottom)
  ) return true;
  if (bird.y + bird.height > canvas.height - groundHeight || bird.y < 0) return true;
  return false;
}

// Generate pipe
function createPipe() {
  const topHeight = Math.random() * (canvas.height - pipeGap - groundHeight - 120) + 60;
  pipes.push({ x: canvas.width, top: topHeight, bottom: topHeight + pipeGap, color: '#06d6a0' });
}

// Draw everything
function draw() {
  // Sky
  const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
  skyGradient.addColorStop(0, '#4ec0ca');
  skyGradient.addColorStop(1, '#3aa5b0');
  ctx.fillStyle = skyGradient;
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // Clouds
  clouds.forEach(cloud => {
    ctx.globalAlpha = cloud.alpha;
    roundRect(cloud.x, cloud.y, cloud.width, cloud.height, 15, '#ffffff');
    ctx.globalAlpha = 1;
  });

  if(inMenu){
    // Main menu
    ctx.fillStyle = '#FFD93D';
    ctx.font = '48px Arial';
    ctx.fillText('FLAPPY BIRD', 40, 200);
    ctx.fillStyle = '#06d6a0';
    ctx.font = '28px Arial';
    ctx.fillText('Click or Space to Play', 40, 300);
    ctx.fillText(`High Score: ${highScore}`, 40, 350);

    // Animate bird in menu
    ctx.save();
    ctx.translate(bird.x + bird.width / 2, bird.y + bird.height / 2 + bird.bounce);
    ctx.rotate(bird.rotation);
    roundRect(-bird.width / 2, -bird.height / 2, bird.width, bird.height, 6, bird.color);
    ctx.fillStyle = '#f4c542';
    ctx.fillRect(-bird.width / 2 - 5, bird.wingOffset - 5, 10, 10);
    ctx.fillRect(bird.width / 2 - 5, -bird.wingOffset - 5, 10, 10);
    ctx.restore();
    return;
  }

  // Bird
  ctx.save();
  ctx.translate(bird.x + bird.width / 2, bird.y + bird.height / 2 + bird.bounce);
  ctx.rotate(bird.rotation);
  roundRect(-bird.width / 2, -bird.height / 2, bird.width, bird.height, 6, bird.color);
  ctx.fillStyle = '#f4c542';
  ctx.fillRect(-bird.width / 2 - 5, bird.wingOffset - 5, 10, 10);
  ctx.fillRect(bird.width / 2 - 5, -bird.wingOffset - 5, 10, 10);
  ctx.restore();

  // Pipes
  pipes.forEach(pipe => {
    roundRect(pipe.x, 0, pipeWidth, pipe.top, 10, pipe.color);
    roundRect(pipe.x, pipe.bottom, pipeWidth, canvas.height - pipe.bottom - groundHeight, 10, pipe.color);
    ctx.fillStyle = '#34c9a3';
    ctx.fillRect(pipe.x, 0, pipeWidth, 10);
    ctx.fillRect(pipe.x, pipe.bottom, pipeWidth, 10);
  });

  // Ground
  groundX -= groundSpeed;
  if (groundX <= -canvas.width) groundX = 0;
  ctx.fillStyle = '#8d5524';
  ctx.fillRect(groundX, canvas.height - groundHeight, canvas.width, groundHeight);
  ctx.fillRect(groundX + canvas.width, canvas.height - groundHeight, canvas.width, groundHeight);
  for(let i=0;i<20;i++){
    ctx.fillStyle='#7a4320';
    ctx.fillRect((i*20+groundX)%canvas.width, canvas.height-20,10,10);
  }

  // Score & High Score
  ctx.fillStyle = '#fff';
  ctx.font = '28px Arial';
  ctx.fillText(`Score: ${score}`, 10, 35);
  ctx.fillText(`High: ${highScore}`, 10, 70);

  // Game Over
  if(gameOver){
    ctx.fillStyle='#ff4b5c';
    ctx.font='48px Arial';
    ctx.fillText('Game Over', 60, canvas.height/2);
    ctx.font='24px Arial';
    ctx.fillText('Click or Space for Menu', 50, canvas.height/2+50);
  }
}

// Update
function update(){
  frame++;

  // Menu animation
  if(inMenu){
    bird.wingOffset+=0.3*bird.wingDirection;
    if(bird.wingOffset>6||bird.wingOffset<-6) bird.wingDirection*=-1;
    bird.bounce+=0.2*bird.bounceDir;
    if(bird.bounce>3||bird.bounce<-3) bird.bounceDir*=-1;
    clouds.forEach(c=>{
      c.x-=c.speed;
      if(c.x+c.width<0) c.x=canvas.width;
      c.alpha+=c.fadeDir;
      if(c.alpha>1||c.alpha<0.4) c.fadeDir*=-1;
    });
    draw();
    requestAnimationFrame(update);
    return;
  }

  if(!gameOver){
    // Bird physics
    bird.velocity+=bird.gravity;
    bird.y+=bird.velocity;
    bird.rotation=Math.min(Math.PI/4,bird.velocity/10);

    // Wing flap & bounce
    bird.wingOffset+=0.3*bird.wingDirection;
    if(bird.wingOffset>6||bird.wingOffset<-6) bird.wingDirection*=-1;
    bird.bounce+=0.2*bird.bounceDir;
    if(bird.bounce>3||bird.bounce<-3) bird.bounceDir*=-1;

    // Clouds
    clouds.forEach(c=>{
      c.x-=c.speed;
      if(c.x+c.width<0) c.x=canvas.width;
      c.alpha+=c.fadeDir;
      if(c.alpha>1||c.alpha<0.4) c.fadeDir*=-1;
    });

    // Pipes
    if(frame%90===0) createPipe();
    pipes.forEach((pipe,i)=>{
      pipe.x-=3;
      if(checkCollision(pipe)) gameOver=true;
      if(pipe.x+pipeWidth===bird.x) score++;
      if(pipe.x+pipeWidth<0) pipes.splice(i,1);
    });
  }

  // Update high score
  if(score>highScore) {
    highScore = score;
    localStorage.setItem('flappyHighScore', highScore);
  }

  draw();
  requestAnimationFrame(update);
}

// Restart
function restart(){
  bird.y=300;
  bird.velocity=0;
  bird.rotation=0;
  bird.wingOffset=0;
  bird.wingDirection=1;
  bird.bounce=0;
  bird.bounceDir=1;
  pipes=[];
  score=0;
  frame=0;
  gameOver=false;
  groundX=0;
  clouds.forEach(c=>{c.x=Math.random()*canvas.width;c.alpha=1;});
  update();
}

// Start
update();
</script>
</body>
</html>
