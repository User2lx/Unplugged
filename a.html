<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake Mega Arcade</title>
<style>
  body {
    margin:0;
    padding:0;
    font-family: Arial, sans-serif;
    background: #111;
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  #menu, #gameUI {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  button, select {
    margin: 10px;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    background: #444;
    color: #fff;
    border: none;
    border-radius: 5px;
  }
  button:hover, select:hover { background: #666; }
  canvas { background: #000; border: 3px solid #fff; }
  #info { margin: 10px; font-size: 18px; }
</style>
</head>
<body>
<div id="menu">
  <h1>Snake Mega Arcade</h1>
  <label>Choose Snake Skin:</label>
  <select id="skinSelector">
    <option value="rainbow">Rainbow</option>
    <option value="green">Green</option>
    <option value="blue">Blue</option>
    <option value="purple">Purple</option>
  </select>
  <button id="startBtn">Start Game</button>
  <div>High Score: <span id="menuHighScore">0</span></div>
</div>

<div id="gameUI" style="display:none;">
  <div id="info">Score: 0 | Level: 1 | High Score: 0</div>
  <canvas id="game" width="400" height="400"></canvas>
  <button id="restart">Restart Game</button>
  <button id="backMenu">Back to Menu</button>
</div>

<script>
const menu = document.getElementById('menu');
const gameUI = document.getElementById('gameUI');
const skinSelector = document.getElementById('skinSelector');
const startBtn = document.getElementById('startBtn');
const backMenu = document.getElementById('backMenu');
const restartBtn = document.getElementById('restart');
const info = document.getElementById('info');
const menuHighScore = document.getElementById('menuHighScore');

const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

const box = 20;
let snake, direction, foods, obstacles, score, level, speed, game;
let highScore = localStorage.getItem('snakeHighScore') || 0;
let powerUps = {};
let skin = 'rainbow';

menuHighScore.textContent = highScore;

function randomPosition() {
  return {x: Math.floor(Math.random()*20)*box, y: Math.floor(Math.random()*20)*box};
}

function initGame() {
  snake = [{x:8*box, y:8*box}];
  direction = 'RIGHT';
  foods = [{type:'normal', ...randomPosition()}];
  obstacles = [];
  for(let i=0;i<5;i++) obstacles.push(randomPosition());
  score = 0;
  level = 1;
  speed = 150;
  powerUps = {};
  info.textContent = `Score: ${score} | Level: ${level} | High Score: ${highScore}`;
  if(game) clearInterval(game);
  game = setInterval(draw, speed);
}

startBtn.addEventListener('click', ()=>{
  skin = skinSelector.value;
  menu.style.display='none';
  gameUI.style.display='flex';
  initGame();
});

restartBtn.addEventListener('click', ()=>initGame());

backMenu.addEventListener('click', ()=>{
  clearInterval(game);
  menu.style.display='flex';
  gameUI.style.display='none';
  menuHighScore.textContent = highScore;
});

document.addEventListener('keydown', e => {
  if(e.key==='ArrowUp' && direction!=='DOWN') direction='UP';
  else if(e.key==='ArrowDown' && direction!=='UP') direction='DOWN';
  else if(e.key==='ArrowLeft' && direction!=='RIGHT') direction='LEFT';
  else if(e.key==='ArrowRight' && direction!=='LEFT') direction='RIGHT';
});

function draw() {
  ctx.fillStyle='#000';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Draw obstacles
  ctx.fillStyle='#555';
  obstacles.forEach(o=>ctx.fillRect(o.x,o.y,box,box));

  // Draw foods
  foods.forEach(f=>{
    ctx.fillStyle=f.type==='normal'?'red':'gold';
    ctx.fillRect(f.x,f.y,box,box);
  });

  // Draw snake
  snake.forEach((seg,i)=>{
    let color;
    if(skin==='rainbow'){
      const hue=(i*30 + Date.now()/10)%360;
      color=`hsl(${hue},100%,50%)`;
    } else if(skin==='green') color='lime';
    else if(skin==='blue') color='cyan';
    else if(skin==='purple') color='magenta';
    ctx.fillStyle=color;
    ctx.fillRect(seg.x,seg.y,box,box);
    ctx.strokeStyle='#111';
    ctx.strokeRect(seg.x,seg.y,box,box);
  });

  // Move snake
  let head={x:snake[0].x, y:snake[0].y};
  if(direction==='UP') head.y-=box;
  if(direction==='DOWN') head.y+=box;
  if(direction==='LEFT') head.x-=box;
  if(direction==='RIGHT') head.x+=box;

  // Wrap-around walls
  if(head.x>=canvas.width) head.x=0;
  if(head.x<0) head.x=canvas.width-box;
  if(head.y>=canvas.height) head.y=0;
  if(head.y<0) head.y=canvas.height-box;

  // Collision with obstacles
  if(obstacles.some(o=>o.x===head.x && o.y===head.y)){ gameOver(); return; }

  // Collision with food
  let ateFood=false;
  foods.forEach((f,idx)=>{
    if(head.x===f.x && head.y===f.y){
      ateFood=true;
      if(f.type==='normal') score+=powerUps.double?2:1;
      else if(f.type==='bonus'){
        score+=powerUps.double?10:5;
        snake=snake.slice(0,Math.max(1,snake.length-2));
        powerUps.speed=30; powerUps.shrink=30;
      }
      foods.splice(idx,1);
      foods.push({type: Math.random()<0.15?'bonus':'normal', ...randomPosition()});
    }
  });

  if(!ateFood) snake.pop();

  // Apply power-up timers
  Object.keys(powerUps).forEach(p=>{ powerUps[p]--; if(powerUps[p]<=0) delete powerUps[p]; });

  // Level up every 5 points
  if(score>=level*5){
    level++;
    speed=Math.max(50,speed-10);
    clearInterval(game);
    game=setInterval(draw,powerUps.speed?speed/1.5:speed);
    obstacles.push(randomPosition());
  }

  info.textContent=`Score: ${score} | Level: ${level} | High Score: ${highScore}`;

  // Collision with self
  if(snake.some(s=>s.x===head.x && s.y===head.y)){ gameOver(); return; }

  snake.unshift(head);
}

function gameOver(){
  clearInterval(game);
  if(score>highScore){
    highScore=score;
    localStorage.setItem('snakeHighScore',highScore);
  }
  ctx.fillStyle='white';
  ctx.font='20px Arial';
  ctx.fillText(`GAME OVER! Score: ${score} | Level: ${level}`,10,canvas.height/2);
  ctx.fillText(`High Score: ${highScore}`,10,canvas.height/2+30);
}
</script>
</body>
</html>
