<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Donkey Kong – Arcade Accurate</title>
<style>
  body {
    margin: 0;
    background: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  canvas {
    image-rendering: pixelated;
    background: #000;
    border: 8px solid #b30000;
    box-shadow: 0 0 40px #ff2a2a;
  }
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
/* ================== ARCADE SPECS ================== */
const SCALE = 4;
const W = 224;
const H = 256;

const canvas = document.getElementById("game");
canvas.width = W * SCALE;
canvas.height = H * SCALE;

const ctx = canvas.getContext("2d");
ctx.imageSmoothingEnabled = false;

const buf = document.createElement("canvas");
buf.width = W;
buf.height = H;
const g = buf.getContext("2d");

/* ================== INPUT ================== */
const keys = {};
addEventListener("keydown", e => keys[e.key] = true);
addEventListener("keyup", e => keys[e.key] = false);

/* ================== CONSTANTS ================== */
const GRAVITY = 0.45;
let frame = 0;

/* ================== PLAYER (16×16 like arcade) ================== */
const mario = {
  x: 16, y: 232,
  w: 16, h: 16,
  vx: 0, vy: 0,
  onGround: false,
  dir: 1
};

/* ================== LEVEL LAYOUT ================== */
const girders = [
  {x:0,y:240,w:224,dir:1},
  {x:16,y:208,w:192,dir:-1},
  {x:0,y:176,w:192,dir:1},
  {x:16,y:144,w:192,dir:-1},
  {x:0,y:112,w:192,dir:1},
  {x:16,y:80,w:192,dir:-1}
];

const ladders = [
  {x:56,y:208,h:32},
  {x:152,y:176,h:32},
  {x:88,y:144,h:32},
  {x:184,y:112,h:32},
  {x:120,y:80,h:32}
];

/* ================== DK & PAULINE ================== */
const dk = { x: 96, y: 48 };
const pauline = { x: 184, y: 48 };

/* ================== BARRELS ================== */
let barrels = [];
setInterval(() => barrels.push({x:112,y:64,vx:1.4,vy:0}), 1800);

/* ================== UPDATE ================== */
function updateMario() {
  mario.vx = 0;
  if (keys["ArrowLeft"]) { mario.vx = -1.5; mario.dir = -1; }
  if (keys["ArrowRight"]) { mario.vx = 1.5; mario.dir = 1; }

  mario.vy += GRAVITY;

  mario.x += mario.vx;
  mario.y += mario.vy;
  mario.onGround = false;

  for (const gdr of girders) {
    if (
      mario.x < gdr.x + gdr.w &&
      mario.x + mario.w > gdr.x &&
      mario.y + mario.h <= gdr.y + 6 &&
      mario.y + mario.h + mario.vy >= gdr.y
    ) {
      mario.y = gdr.y - mario.h;
      mario.vy = 0;
      mario.onGround = true;
    }
  }

  if (keys["ArrowUp"] && mario.onGround) mario.vy = -7;
}

function updateBarrels() {
  for (const b of barrels) {
    b.vy += GRAVITY;
    b.y += b.vy;

    for (const gdr of girders) {
      if (
        b.x > gdr.x && b.x < gdr.x + gdr.w &&
        b.y + 8 > gdr.y && b.y + 8 < gdr.y + 6
      ) {
        b.y = gdr.y - 8;
        b.vy = 0;
        b.vx = 1.4 * gdr.dir;
      }
    }
    b.x += b.vx;
  }
}

/* ================== DRAW HELPERS ================== */
function rect(x,y,w,h,c) {
  g.fillStyle = c;
  g.fillRect(x,y,w,h);
}

/* ================== DRAW ================== */
function draw() {
  g.clearRect(0,0,W,H);

  // Girders
  girders.forEach(p => rect(p.x,p.y,p.w,6,"#c40000"));

  // Ladders
  ladders.forEach(l => rect(l.x,l.y,8,l.h,"#2fbfff"));

  // Donkey Kong
  rect(dk.x,dk.y,32,24,"#7a3a14");

  // Pauline
  rect(pauline.x,pauline.y,8,16,"#ff5ca8");

  // Barrels
  barrels.forEach(b => rect(b.x,b.y,8,8,"#ff8c00"));

  // Mario
  rect(mario.x,mario.y,16,16,"#1e90ff");

  // HUD
  g.fillStyle = "#fff";
  g.font = "8px monospace";
  g.fillText("1UP", 16, 8);
  g.fillText("HIGH SCORE", 80, 8);

  // CRT Scanlines
  ctx.setTransform(SCALE,0,0,SCALE,0,0);
  ctx.drawImage(buf,0,0);
  ctx.fillStyle = "rgba(0,0,0,0.15)";
  for (let y=0;y<H*SCALE;y+=4) ctx.fillRect(0,y,canvas.width,2);
}

/* ================== LOOP ================== */
function loop() {
  frame++;
  updateMario();
  updateBarrels();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
