<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Infinite Action Scroller</title>
<style>
  body { margin: 0; background: #000; overflow: hidden; }
  canvas { display: block; margin: auto; }
</style>
</head>
<body>
<canvas id="game" width="800" height="450"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const gravity = 0.6;
const CHUNK = 800;

let cameraX = 0;
let chunks = {};
let enemies = [];

// BIOMES
const biomes = [
  { bg: "#87ceeb", ground: "#2f3542" }, // plains
  { bg: "#f6d365", ground: "#b97745" }, // desert
  { bg: "#c7ecee", ground: "#535c68" }, // ice
  { bg: "#ff6b6b", ground: "#6D214F" }  // lava
];

// INPUT
const keys = {};
addEventListener("keydown", e => keys[e.key] = true);
addEventListener("keyup", e => keys[e.key] = false);

// PLAYER
const player = {
  x: 100, y: 0, w: 40, h: 50,
  dx: 0, dy: 0,
  speed: 4, jump: 12,
  grounded: false,
  facing: 1,
  health: 5,
  attacking: false,
  atkTimer: 0
};

function hit(a,b){
  return a.x < b.x+b.w && a.x+a.w > b.x &&
         a.y < b.y+b.h && a.y+a.h > b.y;
}

// CHUNK GEN
function genChunk(i){
  if (chunks[i]) return;
  const baseX = i * CHUNK;
  const difficulty = Math.floor(i / 2);
  const biome = biomes[Math.floor(i / 5) % biomes.length];

  const plats = [
    { x: baseX, y: 400, w: CHUNK, h: 50, c: biome.ground }
  ];

  for(let p=0;p<2+Math.random()*2;p++){
    plats.push({
      x: baseX + 100 + Math.random()*600,
      y: 220 + Math.random()*120,
      w: 80 + Math.random()*80,
      h: 20,
      c: biome.ground
    });
  }

  const enemyCount = Math.min(3, 1 + Math.floor(difficulty/3));
  for(let e=0;e<enemyCount;e++){
    enemies.push({
      x: baseX + 200 + Math.random()*400,
      y: 360,
      w: 40, h: 40,
      dx: (Math.random()<0.5?-1:1)*(1+difficulty*0.1),
      hp: 1 + Math.floor(difficulty/4),
      boss: false
    });
  }

  // MINI BOSS
  if (i % 10 === 0 && i > 0){
    enemies.push({
      x: baseX + 400,
      y: 330,
      w: 80, h: 80,
      dx: 1,
      hp: 5 + difficulty,
      boss: true
    });
  }

  chunks[i] = plats;
}

// UPDATE
function update(){
  player.dx = 0;
  if(keys["a"]) { player.dx=-player.speed; player.facing=-1; }
  if(keys["d"]) { player.dx= player.speed; player.facing=1; }

  if((keys["w"]||keys[" "]) && player.grounded){
    player.dy=-player.jump;
    player.grounded=false;
  }

  if(keys["j"] && !player.attacking){
    player.attacking=true;
    player.atkTimer=10;
  }

  player.dy+=gravity;
  player.x+=player.dx;
  player.y+=player.dy;

  cameraX = Math.max(0, player.x - canvas.width/3);

  const ci = Math.floor(player.x/CHUNK);
  genChunk(ci-1); genChunk(ci); genChunk(ci+1);

  player.grounded=false;
  Object.values(chunks).flat().forEach(p=>{
    if(hit(player,p)&&player.dy>0){
      player.y=p.y-player.h;
      player.dy=0;
      player.grounded=true;
    }
  });

  if(player.attacking && --player.atkTimer<=0)
    player.attacking=false;

  enemies.forEach(e=>{
    e.x+=e.dx;
    if(hit(player,e)){
      player.health--;
      player.x-=20*e.dx;
      if(player.health<=0) reset();
    }

    if(player.attacking){
      const atk={
        x:player.x+(player.facing===1?player.w:-30),
        y:player.y+10,w:30,h:30
      };
      if(hit(atk,e)){
        e.hp--;
      }
    }
  });

  enemies=enemies.filter(e=>e.hp>0 && e.x>cameraX-300);
  for(let k in chunks)
    if(k < ci-2) delete chunks[k];
}

// DRAW
function draw(){
  const biome = biomes[Math.floor(player.x/CHUNK/5)%biomes.length];
  canvas.style.background = biome.bg;

  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.translate(-cameraX,0);

  Object.values(chunks).flat().forEach(p=>{
    ctx.fillStyle=p.c;
    ctx.fillRect(p.x,p.y,p.w,p.h);
  });

  ctx.fillStyle="#ff4757";
  ctx.fillRect(player.x,player.y,player.w,player.h);

  if(player.attacking){
    ctx.fillStyle="#ffa502";
    ctx.fillRect(
      player.x+(player.facing===1?player.w:-30),
      player.y+10,30,30
    );
  }

  enemies.forEach(e=>{
    ctx.fillStyle=e.boss?"#8e44ad":"#2ed573";
    ctx.fillRect(e.x,e.y,e.w,e.h);
  });

  ctx.restore();

  ctx.fillStyle="#fff";
  ctx.font="16px monospace";
  ctx.fillText("Health: "+player.health,20,30);
  ctx.fillText("Distance: "+Math.floor(player.x),20,50);
}

function reset(){
  player.x=100; player.y=0;
  player.health=5;
  chunks={}; enemies=[];
}

(function loop(){
  update(); draw();
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
